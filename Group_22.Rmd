---
title: "DAS2021 - Project 2"
author: "Group 22"
date: "11/7/2021"
output:
  pdf_document:
    latex_engine: xelatex
    number_sections: yes
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

```{r libraries}
library(moderndive)
library(knitr)
library(tidyverse)
library(skimr)
```

# Introduction

The objective of this report is to identify the most influential factors that explain the price of a furnishing product sold by IKEA. To this end, a data set from IKEA Saudi Arabia was collected, containing measurements about 500 items of furniture. The variables considered are:

* `item_id` – unique product ID
* `category` – the furniture category the item belongs to
* `price` – the current price in Saudi Riyals (as recorded on 20/04/2020)
* `sellable_online` – a binary variable to indicate whether the item is available to purchase online
* `other_colors` – a binary variable to indicate whether the item is available in other colours
* `depth` – depth of the item in cm
* `height` – height of the item in cm
* `width` – width of the item in cm

More specifically, we are interested in discovering the most important features out of all available that dictate whether a product is more expensive than 1000 Saudi Riyals. For that reason, we create one more binary variable, `priceCat`, to indicate whether a product costs more than 1000 Saudi Riyals.

```{r}
# reading data
ikeadata <- read.csv("./dataset22.csv", row.names = 1)

# split data based on price using the 1000 threshold
ikeadata$priceCat <- ikeadata$price > 1000
```

Throughout the report, we consider various numerical and graphical summaries, followed by the use of an appropriate generalised linear model in order to assess the relationship between the available variables and the 1000 Suadi Riyals threshold related to the price.



# Exploratory Data Analysis

Before conducting any formal data analysis using statistical models, it is useful to explore our data and the relationships between them using numerical and graphical summaries. The following table contains summary statistics for the variables of our data set except for the `item_id` variable as it constitutes an identification variable that does not hold any useful information about the products.

```{r}
ikeadata$item_id <- NULL
ikeadata$category <- as.factor(ikeadata$category)
ikeadata$other_colors <- ikeadata$other_colors == "Yes"


ikeadata %>%
  skim_without_charts()
```

There are several interesting findings from the summary statistics. 

Starting from the top of the table, we observe that we have 4 categorical variables (including the newly-created price based one) and 4 numeric variables. 

* For the furniture category, we observe no missing values and 17 different categories, while a more thorough view of the different categories follows below. 

* The amount of products sold online in our data set completely dominates the amount of the ones that are not, accounting for the 98% of the data set (492 products in total).

* The products available in other colours account for just the 40% of the total amount of products observed. This means that there are only 198 products available in other colours, while 302 products are sold in one colour.

* There are only 183 items priced over 1000 Saudi Riyals, which is roughly one third of the total amount of products observed.

* When the price is considered as a continuous variable, its variance is significantly larger than the rest of the numeric variables, with prices as low as 5 and as high as 9585 Saudi Riyals. However, such a difference can be justified by the different measurement units in which these variables are measured.

* Regarding the depth of the items, it is apparent that almost half of the observed items are lacking a depth measurement (213 items), which is a considerable amount of missing information. Furthermore, comparing it to height and width, the mean value of depth is about half of the corresponding means of the rest of the features. Its standard deviation is about half the standard deviation of height. Moreover, its 50% central sample distribution appears to be lower than that of the others, suggesting that depth is smaller that height and width, in general. Those observations are important since these 3 variables are measured in the same units.

* When it comes to height and width, there are 135 and 77 missing values, respectively. In general, their summary statistics do not present a significant difference. The only two exceptions are their variances and their maximum values. The variance of height is 61.98, while the variance of width is equal to 75.73. Height's maximum value is 321 cm, while width's maximum value is 387 cm.


## Missing values

Due to the significant amount of missing information, it is important to address the issue of missing values before proceeding with our data analysis.

Our first step is to remove observations with 2 or more missing values. Such observations can be considered as items with a significant loss of information to the point that they cannot be useful for analysis.

Additionally, in order to avoid removing more information from the data set, we attempt to replace the missing values of the remaining observations. To this end, we calculate the mean of the missing variable using only those observations that belong to the same furniture category as the observation of interest. Essentially, this is equivalent to fitting a linear regression model with the variable of interest as the response and the `category` variable as the predictor and predicting the missing value using the observation's furniture category.

```{r}
# removing observations with >= 2 NAs
ikeadata <- ikeadata[!apply(is.na(ikeadata), 1, sum) >= 2,]

# replace remaining NAs with means
for (i in 1:nrow(ikeadata)) {
  if(is.na(ikeadata$depth[i])){
    ikeadata$depth[i]<- mean(ikeadata$depth[ikeadata$category == ikeadata[i, "category"]], na.rm = TRUE)
  }
  if(is.na(ikeadata$height[i])){
    ikeadata$height[i]<- mean(ikeadata$height[ikeadata$category == ikeadata[i, "category"]], na.rm = TRUE)
  }
  if(is.na(ikeadata$width[i])){
    ikeadata$width[i]<- mean(ikeadata$width[ikeadata$category == ikeadata[i, "category"]], na.rm = TRUE)
  }
}


ikeadata %>%
  skim_without_charts()
```

After cleaning the data, the overall results are similar to the ones we had before. However, we point out some key differences and similarities:

* The resulting data set now contains 383 products. This corresponds to the removal of 117 products as these contained 2 or more missing values.

* There is a different ordering of levels when we consider the descending order of `category`'s levels by count. "Tables & desks" was the dominating category before cleaning the data. However, many observations under this category contained 2 or more missing values.

* For the `sellable_online` categorical variable, we observe an even larger proportion of items sold online, accounting for the 99% of the total amount of products.

* For `depth`, `height` and `width`. we observe the same dissimilarities along with slightly wider IQRs for each variable. Also, there is a decrease in the variance of `depth` and an increased variance for `width`.

* Finally, the mean and median values of `price` are increased when considering it as a continuous variable. Also, its variance increased significantly.


## Exploring relationships with respect to the price category

* sellable online

```{r}
ggplot(ikeadata, 
       mapping = aes(x = sellable_online, fill = priceCat)) +
  geom_bar(position = "dodge")
```

* other_color
```{r}

t(apply(table(ikeadata$other_colors, ikeadata$priceCat), 2, function(x){x/sum(x)}))

ggplot(ikeadata, 
       mapping = aes(x = priceCat, group = other_colors)) +
  geom_bar(aes(y = ..prop.., fill = other_colors))
```


* price cont, height, width, depth

```{r}
round(cor(ikeadata[c("price", "depth", 
                     "height", "width")]),3) %>%
  kable
```

* price categorical, height, width, depth

```{r}
ggplot(ikeadata,
       mapping = aes(x = priceCat, y = height)) + 
  geom_boxplot()
```

```{r}
ggplot(ikeadata,
       mapping = aes(x = priceCat, y = depth)) + 
  geom_boxplot()
```

```{r}
ggplot(ikeadata,
       mapping = aes(x = priceCat, y = width)) + 
  geom_boxplot()
```